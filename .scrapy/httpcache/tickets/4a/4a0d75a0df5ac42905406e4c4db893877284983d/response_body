<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #23406 (Migrations not found when only .pyc files are available (e.g. in a frozen environment))
     – Django
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/23405" title="Ticket #23405" />
        <link rel="last" href="/ticket/26358" title="Ticket #26358" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/23406?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/23406?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/23406?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/23407" title="Ticket #23407" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <style id="trac-noscript" type="text/css">.trac-noscript { display: none !important }</style>
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search Django" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="c194439d9bc0beebf8673bad";
      var comments_prefs={"comments_only":"false","comments_order":"oldest"};
    </script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/folding.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/wikitoolbar.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/resizer.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/auto_preview.js"></script>
    <script type="text/javascript">
      jQuery("#trac-noscript").remove();
      jQuery(document).ready(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <script type="text/javascript" src="/chrome/common/js/threaded_comments.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
      /*<![CDATA[*/
        $("#attachments").toggleClass("collapsed");
        $("#trac-up-attachments").click(function () {
          $("#attachments").removeClass("collapsed");
          return true;
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
        function setRevertHandler() {
          $("button.trac-revert").click(function() {
            var div = $("div", this);
            var field_name = div[0].id.substr(7);
            var field_value = div.text();
            var input = $("#propertyform *[name=field_" + field_name + "]");
            if (input.length > 0) {
              if (input.filter("input[type=radio]").length > 0) {
                input.val([field_value]);
              } else if (input.filter("input[type=checkbox]").length > 0) {
                input.val(field_value == "1" ? [field_value] : []);
              } else {
                input.val(field_value);
              }
            } else { // Special case for CC checkbox
              input = $("#propertyform input[name=cc_update]").val([]);
            }
            input.change();
            $(this).closest("li").remove();
            return false;
          });
        }
        setRevertHandler();
        var comment_focused = false;
        $("#comment").focus(function() { comment_focused = true; })
                     .blur(function() { comment_focused = false; });
        $("#propertyform").autoSubmit({preview: '1'}, function(data, reply) {
          var items = $(reply);
          // Update ticket box
          $("#ticket").replaceWith(items.filter('#ticket'));
          // Unthread, unrevert and update changelog
          if (!$('#trac-comments-oldest').checked())
            $('#trac-comments-oldest').click().change();
          $("#changelog").replaceWith(items.filter("#changelog"));
          if ($('#trac-comments-only-toggle').attr('checked'))
            $('#trac-comments-only-toggle').click().attr('checked', true);
          // Show warning
          var new_changes = $("#changelog .trac-new");
          $("#trac-edit-warning").toggle(new_changes.length != 0);
          if (new_changes.length != 0)
            $("#changelog").parent().show().removeClass("collapsed");
          // Update view time
          $("#propertyform input[name='view_time']").replaceWith(items.filter("input[name='view_time']"));
          // Update preview
          var preview = $("#ticketchange").html(items.filter('#preview').children());
          var show_preview = preview.children().length != 0;
          $("#ticketchange").toggle(show_preview);
          setRevertHandler();
          // Collapse property form if comment editor has focus
          if (show_preview && comment_focused)
            $("#modify").parent().addClass("collapsed");
          // Execute scripts to load stylesheets
          items.filter("script").appendTo("head");
        }, "#ticketchange .trac-loading");
        $("#trac-comment-editor").autoSubmit({preview_comment: '1'}, function(data, reply) {
          var comment = $("#trac-comment-editor").next("div.comment").html(reply);
          comment.toggle(comment.children().length != 0);
        }, "#changelog .trac-loading");
        /*]]>*/
      });
    </script>
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="${href.chrome('site/css/output-ie.css')}" />
     <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="/chrome/site/css/output.css" />
    <!--<![endif]-->
    <link rel="stylesheet" href="/chrome/site/css/trachacks.css" />
    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.5.6/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Inconsolata:400,700:latin', 'Roboto:400italic,700italic,300,700,400:latin']
        }
    });
    </script>
    <script src="/chrome/site/js/lib/modernizr.js"></script>
      <script type="text/javascript" src="/chrome/site/tickethacks.js"></script>
  </head>
  <body id="generic">
    <div role="banner" id="top">
      <div class="container">
        <a class="logo" href="https://www.djangoproject.com/">Django</a>
        <p class="meta">The web framework for perfectionists with deadlines.</p>
        <nav role="navigation">
          <ul>
            <li><a href="https://www.djangoproject.com/">Overview</a></li>
            <li><a href="https://www.djangoproject.com/download/">Download</a></li>
            <li><a href="https://docs.djangoproject.com/">Documentation</a></li>
            <li><a href="https://www.djangoproject.com/weblog/">News</a></li>
            <li><a href="https://www.djangoproject.com/community/">Community</a></li>
            <li class="active"><a href="/">Code</a></li>
            <li><a href="https://www.djangoproject.com/foundation/">About</a></li>
            <li><a href="https://www.djangoproject.com/fundraising/">♥ Donate</a></li>
          </ul>
        </nav>
      </div>
    </div>
    <div class="copy-banner">
      <div class="container">
        <h1>Code</h1>
      </div>
    </div>
      <div class="container full-width">
        <div role="main">
          <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/github/login">GitHub Login</a></li><li><a href="/login">DjangoProject Login</a></li><li><a href="/prefs">Preferences</a></li><li class="last"><a href="/rpc">API</a></li>
    </ul>
  </div>
          <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/query">View Tickets</a></li><li><a href="/wiki/Reports">Reports</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/wiki">Wiki</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
          <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li class="first"><span>&larr; <a class="prev" href="/ticket/23405" title="Ticket #23405">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="/ticket/23407" title="Ticket #23407">Next Ticket</a> &rarr;</span></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
        <div id="ticket" class="trac-content ">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2014-09-03T08%3A44%3A35-05%3A00&amp;precision=second" title="See timeline at 09/03/14 08:44:35">19 months ago</a></p>
    <p>Last modified <a class="timeline" href="/timeline?from=2015-02-02T01%3A43%3A57-06%3A00&amp;precision=second" title="See timeline at 02/02/15 01:43:57">14 months ago</a></p>
  </div>
  <h2>
    <a href="/ticket/23406" class="trac-id">#23406</a>
    <span class="trac-status">
      <a href="/query?status=new">new</a>
    </span>
    <span class="trac-type">
      <a href="/query?status=!closed&amp;type=Bug">Bug</a>
    </span>
  </h2>
  <h1 id="trac-ticket-title" class="searchable">
    <span class="summary">Migrations not found when only .pyc files are available (e.g. in a frozen environment)</span>
  </h1>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable"><a href="/query?status=!closed&amp;reporter=danielmenzel">danielmenzel</a></td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner"><a href="/query?status=!closed&amp;owner=nobody">nobody</a></td>
    </tr>
    <tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Migrations">Migrations</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version=1.7">1.7</a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=Normal">Normal</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="/query?status=!closed&amp;keywords=~migrations">migrations</a>, <a href="/query?status=!closed&amp;keywords=~.pyc">.pyc</a>, <a href="/query?status=!closed&amp;keywords=~frozen">frozen</a>, <a href="/query?status=!closed&amp;keywords=~cx_Freeze">cx_Freeze</a>
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              <a href="/query?status=!closed&amp;cc=~andrewgodwin">andrewgodwin</a>
        </td>
        <th id="h_stage">
          Triage Stage:
        </th>
        <td headers="h_stage">
              <a href="/query?status=!closed&amp;stage=Accepted">Accepted</a>
        </td>
    </tr><tr>
        <th id="h_has_patch">
          Has patch:
        </th>
        <td headers="h_has_patch">
              <a href="/query?status=!closed&amp;has_patch=0">no</a>
        </td>
        <th id="h_needs_docs">
          Needs documentation:
        </th>
        <td headers="h_needs_docs">
              <a href="/query?status=!closed&amp;needs_docs=0">no</a>
        </td>
    </tr><tr>
        <th id="h_needs_tests">
          Needs tests:
        </th>
        <td headers="h_needs_tests">
              <a href="/query?status=!closed&amp;needs_tests=0">no</a>
        </td>
        <th id="h_needs_better_patch">
          Patch needs improvement:
        </th>
        <td headers="h_needs_better_patch">
              <a href="/query?status=!closed&amp;needs_better_patch=0">no</a>
        </td>
    </tr><tr>
        <th id="h_easy">
          Easy pickings:
        </th>
        <td headers="h_easy">
              <a href="/query?status=!closed&amp;easy=0">no</a>
        </td>
        <th id="h_ui_ux">
          UI/UX:
        </th>
        <td headers="h_ui_ux">
              <a href="/query?status=!closed&amp;ui_ux=0">no</a>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <h2 id="Description">Description</h2>
<p>
When only <strong>.pyc</strong> files are available, for example in a frozen environment after running <em>cx_Freeze</em> or similar tools, migrations no longer work: the migrate command does not find any migrations to apply, and produces the following output:<br />
</p>
<pre class="wiki">Operations to perform:
  Synchronize unmigrated apps: &lt;some apps that really have no migrations&gt;
  Apply all migrations: (none)
Synchronizing apps without migrations:
  Creating tables...
    Creating table &lt;some tables&gt;
  Installing custom SQL...
  Installing indexes...
Running migrations:
  No migrations to apply.
  Your models have changes that are not yet reflected in a migration, and so won't be applied.
  Run 'manage.py makemigrations' to make new migrations, and then re-run 'manage.py migrate' to apply them.
</pre><p>
Subsequent operations then fail because the database is unmigrated.<br />
</p>
<p>
The typical content of a frozen migrations folder looks like this:<br />
</p>
<pre class="wiki">django
  contrib
    contenttypes
      migrations
        __init__.pyc
        0001_initial.pyc
</pre><h2 id="Analysis">Analysis</h2>
<p>
Due to issue <a href="https://code.djangoproject.com/ticket/23237">https://code.djangoproject.com/ticket/23237</a>, there was a change in django.db.migrations.loader (<a href="https://code.djangoproject.com/changeset/267630ad50c69ebfe594de37a0636264aa5be7d6">https://code.djangoproject.com/changeset/267630ad50c69ebfe594de37a0636264aa5be7d6</a>): Previously, migrations were found if they had a <strong>.py</strong>, <strong>.pyc</strong>, or <strong>.pyo</strong> extension. Now only migrations with <strong>.py</strong> extensions are found.<br />
</p>
<p>
Perhaps it would be possible to add a check if Django is running in a frozen environment:<br />
</p>
<pre class="wiki">if hasattr(sys, 'frozen'):
    extensions = ('.py', '.pyc')
else:
    extensions = ('.py', )
...
if name.endswith(extensions):
    ...
</pre><p>
or make the list of allowed extensions configurable by the user.<br />
</p>

    </div>
  </div>
</div>
          
    <div id="attachments">
        <h3 class="foldable">Attachments <span class="trac-count">(1)</span></h3>
        <div class="attachments">
          <dl class="attachments">
              <dt>
    <a href="/attachment/ticket/23406/migrations_loader.patch" title="View attachment">migrations_loader.patch</a><a href="/raw-attachment/ticket/23406/migrations_loader.patch" class="trac-rawlink" title="Download">​</a>
       (<span title="1367 bytes">1.3 KB</span>) -
      added by <em>jdetaeye</em> <a class="timeline" href="/timeline?from=2015-01-29T02%3A15%3A52-06%3A00&amp;precision=second" title="See timeline at 01/29/15 02:15:52">14 months ago</a>.
  </dt>
              <dd>
                Patch to support loading from Python packages in any format
              </dd>
          </dl>
          <p>
            Download all attachments as: <a rel="nofollow" href="/zip-attachment/ticket/23406/">.zip</a>
          </p>
          
        </div>
    </div>

        <div>
          <div style="position: relative">
            <form id="prefs" method="get" action="/prefs" style="position: absolute; right: 0">
              <div id="trac-comments-order">
                <input type="radio" id="trac-comments-oldest" name="trac-comments-order" value="oldest" checked="checked" />
                <label for="trac-comments-oldest">Oldest first</label>
                <input type="radio" id="trac-comments-newest" name="trac-comments-order" value="newest" />
                <label for="trac-comments-newest">Newest first</label>
                <span id="trac-threaded-toggle" style="display: none">
                  <input type="radio" id="trac-comments-threaded" name="trac-comments-order" value="threaded" />
                  <label for="trac-comments-threaded">Threaded</label>
                </span>
              </div>
              <div>
                <input id="trac-comments-only-toggle" type="checkbox" />
                <label for="trac-comments-only-toggle">Comments only</label>
              </div>
            </form>
          </div>
          <h3 class="foldable">Change History <span class="trac-count">(19)</span></h3>
          <div id="changelog">
              <div class="change" id="trac-change-1-1409753312577054">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:1" class="cnum">
    <a href="#comment:1">comment:1</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-03T09%3A08%3A32-05%3A00&amp;precision=second" title="See timeline at 09/03/14 09:08:32">19 months ago</a> by timgraham
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-cc">
      <strong class="trac-field-cc">Cc</strong>
        <em>andrewgodwin</em> added
    </li><li class="trac-field-needs_docs">
      <strong class="trac-field-needs_docs">Needs documentation</strong>
        unset
    </li><li class="trac-field-needs_tests">
      <strong class="trac-field-needs_tests">Needs tests</strong>
        unset
    </li><li class="trac-field-needs_better_patch">
      <strong class="trac-field-needs_better_patch">Patch needs improvement</strong>
        unset
    </li><li class="trac-field-stage">
      <strong class="trac-field-stage">Triage Stage</strong>
        changed from <em>Unreviewed</em> to <em>Accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      <p>
I forget the reasoning, but I believe the decision was not to support frozen environments. We should at least document this.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2-1409753492043587">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:2" class="cnum">
    <a href="#comment:2">comment:2</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-03T09%3A11%3A32-05%3A00&amp;precision=second" title="See timeline at 09/03/14 09:11:32">19 months ago</a> by carljm
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
The reason for the change was because treating an orphan <tt>.pyc</tt> as a real migration causes too many problems with things like switching branches in git.<br />
</p>
<p>
I think not looking for <tt>.pyc</tt> files is the right default behavior, but I wouldn't have any problem with some form of configurability to support things like cx_Freeze.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3-1409757157641041">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:3" class="cnum">
    <a href="#comment:3">comment:3</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-03T10%3A12%3A37-05%3A00&amp;precision=second" title="See timeline at 09/03/14 10:12:37">19 months ago</a> by andrewgodwin
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Well, we'd have to introduce a setting if we wanted to make this work (a la SOUTH_INCLUDE_PYC), and I'm somewhat averse to adding more settings than necessary. We definitely can't change the default behaviour back; people were seeing all sorts of bugs when switching branches due to .pyc files.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4-1409757494016899">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:4" class="cnum">
    <a href="#comment:4">comment:4</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-03T10%3A18%3A14-05%3A00&amp;precision=second" title="See timeline at 09/03/14 10:18:14">19 months ago</a> by bmispelon
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Can't we get away with an option passed to the command (something like <tt>--pyc</tt>)?<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5-1409757610722090">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:5" class="cnum">
    <a href="#comment:5">comment:5</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-03T10%3A20%3A10-05%3A00&amp;precision=second" title="See timeline at 09/03/14 10:20:10">19 months ago</a> by danielmenzel
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Or perhaps add the list of searched extensions as a class attribute, so that monkey-patching is made easier?<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6-1409757651803111">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:6" class="cnum">
    <a href="#comment:6">comment:6</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-03T10%3A20%3A51-05%3A00&amp;precision=second" title="See timeline at 09/03/14 10:20:51">19 months ago</a> by andrewgodwin
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
If it was to work correctly, it would need to be passed to <tt>makemigrations</tt>, <tt>migrate</tt>, <tt>sqlmigrate</tt> and <tt>squashmigrations</tt>, but I suspect we could get away with just adding it to <tt>migrate</tt> and <tt>sqlmigrate</tt>? I'm still not sure about that, but seems better than a setting.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7-1409774789537722">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:7" class="cnum">
    <a href="#comment:7">comment:7</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-03T15%3A06%3A29-05%3A00&amp;precision=second" title="See timeline at 09/03/14 15:06:29">19 months ago</a> by shaib
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I think migrate and sqlmigrate are the only required ones for the use-case (you don't generate or manipulate migrations in a frozen environment).<br />
</p>
<p>
But I don't like the flag approach -- it essentially passes the problem from the developer to their user.<br />
</p>
<p>
I think the correct approach is an app that overrides ("enhances", if you like) the built-in migration commands, in much the same way that South enhanced <tt>syncdb</tt>. If it is hard to write as a 3rd-party app, we should make the changes required to make it easy.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8-1409953849724737">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:8" class="cnum">
    <a href="#comment:8">comment:8</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-05T16%3A50%3A49-05%3A00&amp;precision=second" title="See timeline at 09/05/14 16:50:49">19 months ago</a> by andrewgodwin
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Well, there's definitely a call here to have the underlying implementation (i.e. <tt>MigrationLoader</tt>) take a list of extensions to allow, and then I think we may as well go the extra leg and add a --pyc flag; I'd hate to have people have to override the entire command just to get this behaviour.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9-1410078898813505">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:9" class="cnum">
    <a href="#comment:9">comment:9</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-09-07T03%3A34%3A58-05%3A00&amp;precision=second" title="See timeline at 09/07/14 03:34:58">19 months ago</a> by thedrow
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
+1 for --pyc. I think it's a good idea.<br />
Having to extend anything in the code in order to migrate on frozen environments seems like a bit too much work.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10-1412992754053529">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:10" class="cnum">
    <a href="#comment:10">comment:10</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:11" class="follow-up">↓ 11</a>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-10-10T20%3A59%3A14-05%3A00&amp;precision=second" title="See timeline at 10/10/14 20:59:14">17 months ago</a> by shaib
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Yeah, the idea to add an app was mostly a way to do this in settings.py without introducing a new setting.<br />
</p>
<p>
So I take that back. But the main point remains: The determination of how migrations are found is a property of the deployment, not a property of a single invocation of migration commands. A setting is much better than a flag.<br />
</p>
<p>
On a related note, the setting should probably be more general than just "use .pyc's". What about finding migrations in zip files? I can come up with a couple of less likely candidates as well.<br />
</p>
<p>
So yes, scratch the app overriding the commands. We need a setting to specify the path to a migration loader, and we probably need to ship, along with the standard loader, one which picks up .pyc files (and maybe one which peeks in archives).<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11-1419879011257608">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:11" class="cnum">
    <a href="#comment:11">comment:11</a>
  </span>
        in reply to:
    <a href="#comment:10">↑ 10</a>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-12-29T12%3A50%3A11-06%3A00&amp;precision=second" title="See timeline at 12/29/14 12:50:11">15 months ago</a> by andreydani
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I agree a setting for the file extension would be better. <br />
</p>
<p>
I would like to use *.pyc on production (frozen) environments, but not when developing or testing.<br />
</p>
<p>
I have also made a small <strong>os.listdir</strong> replacement that searches for modules inside zip files.<br />
</p>
<pre class="wiki">def listdir(path):
    if not os.path.isdir(path):
        pos = path.lower().find('.zip')
        if pos &gt;= 0:
            pos += 4
            zip = path[:pos]
            path_within = path[pos + 1:].replace('\\', '/')
            from zipfile import ZipFile
            zip = ZipFile(zip)
            return [a[len(path_within)+1:] for a in zip.namelist() if a.startswith(path_within)]
    return os.listdir(path)
</pre>
    </div>

              </div>
              <div class="change" id="trac-change-12-1422481694482641">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:12" class="cnum">
    <a href="#comment:12">comment:12</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-01-28T15%3A48%3A14-06%3A00&amp;precision=second" title="See timeline at 01/28/15 15:48:14">14 months ago</a> by jdetaeye
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
The Django commands had the same issue:  The code scanned for files in the folder with a certain extension, rather than using the proper Python API to peek inside the contents of the package.<br />
Please have a look at ticket <a class="closed ticket" href="/ticket/8280" title="Bug: Commands framework doesn't support alternate import methods (closed: fixed)">#8280</a> and its resolution.<br />
</p>
<p>
6(!) years after reporting, this got fixed. And history repeats itself now with the migrations...<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13-1422482899506303">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:13" class="cnum">
    <a href="#comment:13">comment:13</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-01-28T16%3A08%3A19-06%3A00&amp;precision=second" title="See timeline at 01/28/15 16:08:19">14 months ago</a> by carljm
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I'm not sure the fix for <a class="closed ticket" href="/ticket/8280" title="Bug: Commands framework doesn't support alternate import methods (closed: fixed)">#8280</a> is actually appropriate here - I don't believe that by default orphan <tt>.pyc</tt> files should be considered as present migrations. I think the practical hassles that causes to daily development with e.g. git branches outweigh the purity of using the proper Python API for module discovery.<br />
</p>
<p>
The distinction here is that usually the presence or absence of a module that hasn't been explicitly requested doesn't fundamentally alter the behavior of the system. With management commands, it does a bit (they'll show up in help) but not in a way that's likely to break anything. Here, having extra migrations around that shouldn't be around in this branch seriously breaks things.<br />
</p>
<p>
If we made migrations discover <tt>.pyc</tt> by default, we would basically have to document that <tt>PYTHONDONTWRITEBYTECODE=1</tt> is required for effective local development in Django.<br />
</p>
<p>
I'm not opposed to an option to enable <tt>.pyc</tt> discovery, but I am opposed to making it the default.<br />
</p>

    </div>

              </div>
              <div class="change">
                
  <h3 class="change">
    <span class="threading">
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-01-29T02%3A15%3A52-06%3A00&amp;precision=second" title="See timeline at 01/29/15 02:15:52">14 months ago</a> by jdetaeye
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-attachment">
      <strong class="trac-field-attachment">Attachment</strong>
        <a href="/attachment/ticket/23406/migrations_loader.patch"><em>migrations_loader.patch</em></a><a href="/raw-attachment/ticket/23406/migrations_loader.patch" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      <p>
Patch to support loading from Python packages in any format<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14-1422519919726958">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:14" class="cnum">
    <a href="#comment:14">comment:14</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:15" class="follow-up">↓ 15</a>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-01-29T02%3A25%3A19-06%3A00&amp;precision=second" title="See timeline at 01/29/15 02:25:19">14 months ago</a> by jdetaeye
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
For what it's worth, a patch is attached for this issue. It allows migrations in any package format to be picked up, be it zip, egg, file, ... <br />
</p>
<blockquote class="citation">
<p>
I think the practical hassles that causes to daily development with e.g. git branches outweigh the purity of using the proper Python API for module discovery."<br />
</p>
</blockquote>
<p>
I don't agree with this comment. <br />
IMHO, a migration is a python package just like any other, and should be treated as such.If some development practices have an issue with that it's their problem - not django's.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-15-1422553854409648">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:15" class="cnum">
    <a href="#comment:15">comment:15</a>
  </span>
        in reply to:
    <a href="#comment:14">↑ 14</a>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-01-29T11%3A50%3A54-06%3A00&amp;precision=second" title="See timeline at 01/29/15 11:50:54">14 months ago</a> by carljm
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="/ticket/23406#comment:14" title="Comment 14">jdetaeye</a>:<br />
</p>
<blockquote class="citation">
<p>
IMHO, a migration is a python package just like any other, and should be treated as such.<br />
</p>
</blockquote>
<p>
It's not a package like any other, because normal Python packages don't have an effect on the system unless explicitly imported.<br />
</p>
<blockquote class="citation">
<p>
If some development practices have an issue with that it's their problem - not django's.<br />
</p>
</blockquote>
<p>
Your patch will cause serious, difficult to debug problems for any development practice which involves adding and removing Python modules (including migrations) from source code under local development, while ignoring <tt>pyc</tt> files. (I know this is the case, because for a period of time in the 1.7 development process, orphan <tt>pyc</tt> files were loaded as migrations, and it did cause these problems.) I think you would be hard pressed to find any current common Django development process that doesn't fit that description.<br />
</p>
<p>
If you have a practical proposal for how to address that problem (whether with documentation changes or otherwise) in your patch, I'm interested in discussing it. If you think it's "not Django's problem" and can be ignored, I'm afraid we just disagree, and I have to remain -1 on merging your patch.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-16-1422555502771574">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:16" class="cnum">
    <a href="#comment:16">comment:16</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-01-29T12%3A18%3A22-06%3A00&amp;precision=second" title="See timeline at 01/29/15 12:18:22">14 months ago</a> by aaugustin
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I agree with Carl.<br />
</p>
<p>
Arguments along the lines of "it's the user's problem" are a red flag when the problem is likely to affect the vast majority of users — in this case, everyone who uses a VCS and doesn't have <tt>PYTHONDONTWRITEBYTECODE</tt> set.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17-1422862644320862">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:17" class="cnum">
    <a href="#comment:17">comment:17</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-02-02T01%3A37%3A24-06%3A00&amp;precision=second" title="See timeline at 02/02/15 01:37:24">14 months ago</a> by jdetaeye
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Fair enough, I understand the arguments.<br />
</p>
<p>
My use case is somewhat different. I'm packaging my product with py2exe as an easy-to-install application (especially for Windows users).  Out of the 7 python packages it needs, only Django needs patching to behave nicely in a frozen zip-file... <br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-18-1422863037796642">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:18" class="cnum">
    <a href="#comment:18">comment:18</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-02-02T01%3A43%3A57-06%3A00&amp;precision=second" title="See timeline at 02/02/15 01:43:57">14 months ago</a> by carljm
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I understand the use case. (I would guess that none of your other six dependencies have a situation with similar constraints to Django migration files). As I said before, I'm in favor of a patch that would change your case from "Django needs patching" to "Django needs a non-default flag/setting." That's why this ticket is in Accepted state. It's just waiting for a patch that implements it as a non-default option.<br />
</p>
<p>
I also agree with Shai that a setting is more appropriate than a flag, because this is a property of a deployment, not a particular invocation.<br />
</p>
<p>
(There remains an open question about zipfiles, I guess. I have no problem with supporting zip-import by default, but I'm not sure if it's possible to do that without also supporting <tt>.pyc</tt> by default, which is problematic.)<br />
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/23406?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/23406?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/23406?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
          <a href="#top" class="backtotop"><i class="icon icon-chevron-up"></i> Back to Top</a>
        </div>
      </div>
    <div role="contentinfo">
      <div class="subfooter">
        <div class="container">
          <h1 class="visuallyhidden">Django Links</h1>
          <div class="col learn">
            <h2>Learn More</h2>
            <ul>
              <li><a href="https://www.djangoproject.com/overview/">About Django</a></li>
              <li><a href="https://www.djangoproject.com/start/">Getting Started with Django</a></li>
              <li><a href="https://www.djangoproject.com/foundation/">Django Software Foundation</a></li>
              <li><a href="https://www.djangoproject.com/conduct/">Code of Conduct</a></li>
            </ul>
          </div>
          <div class="col involved">
            <h2>Get Involved</h2>
            <ul>
              <li><a href="https://www.djangoproject.com/community/">Join a Group</a></li>
              <li><a href="https://docs.djangoproject.com/en/dev/internals/contributing/">Contribute to Django</a></li>
              <li><a href="https://docs.djangoproject.com/en/dev/internals/contributing/bugs-and-features/#reporting-security-issues">Submit a Bug</a></li>
              <li><a href="https://docs.djangoproject.com/en/dev/internals/security/">Report a Security Issue</a></li>
            </ul>
          </div>
          <div class="col follow">
            <h2>Follow Us</h2>
            <ul>
              <li><a href="http://github.com/django">GitHub</a></li>
              <li><a href="https://twitter.com/djangoproject">Twitter</a></li>
              <li><a href="https://www.djangoproject.com/rss/weblog/">News RSS</a></li>
              <li><a href="https://groups.google.com/forum/#!forum/django-users">Django Users Mailing List</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="footer-logo">
            <a class="logo" href="https://djangoproject.com/">Django</a>
          </div>
          <ul class="thanks">
            <li><span>Hosting by</span> <a class="rackspace" href="http://rackspace.com">Rackspace</a></li>
            <li class="design"><span>Design by</span> <a class="threespot" href="http://www.threespot.com">Threespot</a> <span class="ampersand">&amp;</span> <a class="andrevv" href="http://andrevv.com/"></a></li>
          </ul>
          <p class="copyright">© 2005-2016
              <a href="https://djangoproject.com/foundation/"> Django Software
              Foundation</a> unless otherwise noted. Django is a
              <a href="https://djangoproject.com/trademarks/">registered
              trademark</a> of the Django Software Foundation.
          </p>
        </div>
      </div>
    </div>
  <script data-main="/chrome/site/js/main.js" src="/chrome/site/js/lib/require.js"></script>
  </body>
</html>