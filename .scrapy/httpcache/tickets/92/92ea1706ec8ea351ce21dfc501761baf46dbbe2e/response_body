<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #23746 (Allow assertNumQueries to clear caches before it runs)
     – Django
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/23745" title="Ticket #23745" />
        <link rel="last" href="/ticket/26358" title="Ticket #26358" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/23746?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/23746?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/23746?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/23747" title="Ticket #23747" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <style id="trac-noscript" type="text/css">.trac-noscript { display: none !important }</style>
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search Django" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="c194439d9bc0beebf8673bad";
      var comments_prefs={"comments_only":"false","comments_order":"oldest"};
    </script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/folding.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/wikitoolbar.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/resizer.js"></script>
      <script type="text/javascript" charset="utf-8" src="/chrome/common/js/auto_preview.js"></script>
    <script type="text/javascript">
      jQuery("#trac-noscript").remove();
      jQuery(document).ready(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <script type="text/javascript" src="/chrome/common/js/threaded_comments.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
      /*<![CDATA[*/
        $("#attachments").toggleClass("collapsed");
        $("#trac-up-attachments").click(function () {
          $("#attachments").removeClass("collapsed");
          return true;
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
        function setRevertHandler() {
          $("button.trac-revert").click(function() {
            var div = $("div", this);
            var field_name = div[0].id.substr(7);
            var field_value = div.text();
            var input = $("#propertyform *[name=field_" + field_name + "]");
            if (input.length > 0) {
              if (input.filter("input[type=radio]").length > 0) {
                input.val([field_value]);
              } else if (input.filter("input[type=checkbox]").length > 0) {
                input.val(field_value == "1" ? [field_value] : []);
              } else {
                input.val(field_value);
              }
            } else { // Special case for CC checkbox
              input = $("#propertyform input[name=cc_update]").val([]);
            }
            input.change();
            $(this).closest("li").remove();
            return false;
          });
        }
        setRevertHandler();
        var comment_focused = false;
        $("#comment").focus(function() { comment_focused = true; })
                     .blur(function() { comment_focused = false; });
        $("#propertyform").autoSubmit({preview: '1'}, function(data, reply) {
          var items = $(reply);
          // Update ticket box
          $("#ticket").replaceWith(items.filter('#ticket'));
          // Unthread, unrevert and update changelog
          if (!$('#trac-comments-oldest').checked())
            $('#trac-comments-oldest').click().change();
          $("#changelog").replaceWith(items.filter("#changelog"));
          if ($('#trac-comments-only-toggle').attr('checked'))
            $('#trac-comments-only-toggle').click().attr('checked', true);
          // Show warning
          var new_changes = $("#changelog .trac-new");
          $("#trac-edit-warning").toggle(new_changes.length != 0);
          if (new_changes.length != 0)
            $("#changelog").parent().show().removeClass("collapsed");
          // Update view time
          $("#propertyform input[name='view_time']").replaceWith(items.filter("input[name='view_time']"));
          // Update preview
          var preview = $("#ticketchange").html(items.filter('#preview').children());
          var show_preview = preview.children().length != 0;
          $("#ticketchange").toggle(show_preview);
          setRevertHandler();
          // Collapse property form if comment editor has focus
          if (show_preview && comment_focused)
            $("#modify").parent().addClass("collapsed");
          // Execute scripts to load stylesheets
          items.filter("script").appendTo("head");
        }, "#ticketchange .trac-loading");
        $("#trac-comment-editor").autoSubmit({preview_comment: '1'}, function(data, reply) {
          var comment = $("#trac-comment-editor").next("div.comment").html(reply);
          comment.toggle(comment.children().length != 0);
        }, "#changelog .trac-loading");
        /*]]>*/
      });
    </script>
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="${href.chrome('site/css/output-ie.css')}" />
     <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="/chrome/site/css/output.css" />
    <!--<![endif]-->
    <link rel="stylesheet" href="/chrome/site/css/trachacks.css" />
    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.5.6/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Inconsolata:400,700:latin', 'Roboto:400italic,700italic,300,700,400:latin']
        }
    });
    </script>
    <script src="/chrome/site/js/lib/modernizr.js"></script>
      <script type="text/javascript" src="/chrome/site/tickethacks.js"></script>
  </head>
  <body id="generic">
    <div role="banner" id="top">
      <div class="container">
        <a class="logo" href="https://www.djangoproject.com/">Django</a>
        <p class="meta">The web framework for perfectionists with deadlines.</p>
        <nav role="navigation">
          <ul>
            <li><a href="https://www.djangoproject.com/">Overview</a></li>
            <li><a href="https://www.djangoproject.com/download/">Download</a></li>
            <li><a href="https://docs.djangoproject.com/">Documentation</a></li>
            <li><a href="https://www.djangoproject.com/weblog/">News</a></li>
            <li><a href="https://www.djangoproject.com/community/">Community</a></li>
            <li class="active"><a href="/">Code</a></li>
            <li><a href="https://www.djangoproject.com/foundation/">About</a></li>
            <li><a href="https://www.djangoproject.com/fundraising/">♥ Donate</a></li>
          </ul>
        </nav>
      </div>
    </div>
    <div class="copy-banner">
      <div class="container">
        <h1>Code</h1>
      </div>
    </div>
      <div class="container full-width">
        <div role="main">
          <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/github/login">GitHub Login</a></li><li><a href="/login">DjangoProject Login</a></li><li><a href="/prefs">Preferences</a></li><li class="last"><a href="/rpc">API</a></li>
    </ul>
  </div>
          <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/query">View Tickets</a></li><li><a href="/wiki/Reports">Reports</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/wiki">Wiki</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
          <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li class="first"><span>&larr; <a class="prev" href="/ticket/23745" title="Ticket #23745">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="/ticket/23747" title="Ticket #23747">Next Ticket</a> &rarr;</span></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
        <div id="ticket" class="trac-content ">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2014-11-01T16%3A23%3A43-05%3A00&amp;precision=second" title="See timeline at 11/01/14 16:23:43">17 months ago</a></p>
    <p>Last modified <a class="timeline" href="/timeline?from=2015-03-13T11%3A18%3A42-05%3A00&amp;precision=second" title="See timeline at 03/13/15 11:18:42">12 months ago</a></p>
  </div>
  <h2>
    <a href="/ticket/23746" class="trac-id">#23746</a>
    <span class="trac-status">
      <a href="/query?status=new">new</a>
    </span>
    <span class="trac-type">
      <a href="/query?status=!closed&amp;type=New+feature">New feature</a>
    </span>
  </h2>
  <h1 id="trac-ticket-title" class="searchable">
    <span class="summary">Allow assertNumQueries to clear caches before it runs</span>
  </h1>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable"><a href="/query?status=!closed&amp;reporter=wrwrwr">wrwrwr</a></td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner"><a href="/query?status=!closed&amp;owner=nobody">nobody</a></td>
    </tr>
    <tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Testing+framework">Testing framework</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version=master">master</a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=Normal">Normal</a>
        </td>
        <th id="h_keywords" class="missing">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              <a href="/query?status=!closed&amp;cc=~timgraham">timgraham</a>
        </td>
        <th id="h_stage">
          Triage Stage:
        </th>
        <td headers="h_stage">
              <a href="/query?status=!closed&amp;stage=Accepted">Accepted</a>
        </td>
    </tr><tr>
        <th id="h_has_patch">
          Has patch:
        </th>
        <td headers="h_has_patch">
              <a href="/query?status=!closed&amp;has_patch=1">yes</a>
        </td>
        <th id="h_needs_docs">
          Needs documentation:
        </th>
        <td headers="h_needs_docs">
              <a href="/query?status=!closed&amp;needs_docs=0">no</a>
        </td>
    </tr><tr>
        <th id="h_needs_tests">
          Needs tests:
        </th>
        <td headers="h_needs_tests">
              <a href="/query?status=!closed&amp;needs_tests=0">no</a>
        </td>
        <th id="h_needs_better_patch">
          Patch needs improvement:
        </th>
        <td headers="h_needs_better_patch">
              <a href="/query?status=!closed&amp;needs_better_patch=1">yes</a>
        </td>
    </tr><tr>
        <th id="h_easy">
          Easy pickings:
        </th>
        <td headers="h_easy">
              <a href="/query?status=!closed&amp;easy=0">no</a>
        </td>
        <th id="h_ui_ux">
          UI/UX:
        </th>
        <td headers="h_ui_ux">
              <a href="/query?status=!closed&amp;ui_ux=0">no</a>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <a href="/ticket/23746?action=diff&amp;version=1" class="lastmod trac-diff" title="2014-11-01 21:25:28.157866+00:00">
        (last modified by wrwrwr)
      </a>
    </h3>
    <div class="searchable">
      <p>
The <tt>assertNumQueries</tt> manager / method may return different results depending on what is in various caches. Consequently, some tests using it rely on test ordering, particularly those that count some content type queries. For instance if you <a href="https://code.djangoproject.com/ticket/23742">run the suite in reverse</a> you'll see <tt>test_group_permission_performance</tt> failing due to <tt>ContentType</tt> being or not being asked about <tt>auth.Group</tt> in some preceding test <sup><a class="new ticket" href="/ticket/23746#f1" title="New feature: Allow assertNumQueries to clear caches before it runs (new)">1</a></sup>.<br />
</p>
<p>
<a class="ext-link" href="https://github.com/wrwrwr/django/compare/fix/assert-num-queries-cache-dependence"><span class="icon">​</span>The proposed solution</a> resets "query" caches on entering the manager (with a switch to disable it for actual caching tests). After introducing the change 10 tests started to fail (<tt>ContentType</tt> cache tests and some <tt>prefetch_related</tt> tests), 2 specific workarounds were no longer necessary (<a class="closed ticket" href="/ticket/17377" title="Bug: Test admin_views.UserAdminTest.test_user_permission_performance ... (closed: fixed)">#17377</a>, <a class="closed ticket" href="/ticket/20432" title="Bug: GroupAdminTest.test_group_permission_performance fail on full test ... (closed: fixed)">#20432</a>) and a failure from <a class="ext-link" href="https://github.com/django/django/pull/3426"><span class="icon">​</span>PR 3426</a> disappeared <sup><a class="new ticket" href="/ticket/23746#f2" title="New feature: Allow assertNumQueries to clear caches before it runs (new)">2</a></sup>.<br />
</p>
<p>
<br />
</p>
<p>
Note to prospective reviewers: Are there any other caches that should be cleared besides the <tt>ContentType</tt> and <tt>Site</tt>? Related objects caches maybe? Do the affected <tt>prefetch_related</tt> operations actually require content type queries? Would it be better to clear all the caches after every test case to avoid other kinds of dependencies?<br />
</p>
<p>
[1]<span class="wikianchor" id="f1"></span> What happens in the likewise failing with "--reverse" <tt>test_user_permission_performance</tt> is a bit intriguing and probably more involved -- two identical content type queries, savepoint, content type insertion and a release?<br />
</p>
<p>
[2]<span class="wikianchor" id="f2"></span> Only tested with Python 3.3 / Postgres,<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <div style="position: relative">
            <form id="prefs" method="get" action="/prefs" style="position: absolute; right: 0">
              <div id="trac-comments-order">
                <input type="radio" id="trac-comments-oldest" name="trac-comments-order" value="oldest" checked="checked" />
                <label for="trac-comments-oldest">Oldest first</label>
                <input type="radio" id="trac-comments-newest" name="trac-comments-order" value="newest" />
                <label for="trac-comments-newest">Newest first</label>
                <span id="trac-threaded-toggle" style="display: none">
                  <input type="radio" id="trac-comments-threaded" name="trac-comments-order" value="threaded" />
                  <label for="trac-comments-threaded">Threaded</label>
                </span>
              </div>
              <div>
                <input id="trac-comments-only-toggle" type="checkbox" />
                <label for="trac-comments-only-toggle">Comments only</label>
              </div>
            </form>
          </div>
          <h3 class="foldable">Change History <span class="trac-count">(7)</span></h3>
          <div id="changelog">
              <div class="change" id="trac-change-1-1414877128157866">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:1" class="cnum">
    <a href="#comment:1">comment:1</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-11-01T16%3A25%3A28-05%3A00&amp;precision=second" title="See timeline at 11/01/14 16:25:28">17 months ago</a> by wrwrwr
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-description">
      <strong class="trac-field-description">Description</strong>
        modified (<a href="/ticket/23746?action=diff&amp;version=1">diff</a>)
    </li><li class="trac-field-needs_docs">
      <strong class="trac-field-needs_docs">Needs documentation</strong>
        unset
    </li><li class="trac-field-needs_tests">
      <strong class="trac-field-needs_tests">Needs tests</strong>
        unset
    </li><li class="trac-field-needs_better_patch">
      <strong class="trac-field-needs_better_patch">Patch needs improvement</strong>
        unset
    </li>
  </ul>

              </div>
              <div class="change" id="trac-change-2-1415020033489035">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:2" class="cnum">
    <a href="#comment:2">comment:2</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-11-03T07%3A07%3A13-06%3A00&amp;precision=second" title="See timeline at 11/03/14 07:07:13">17 months ago</a> by timgraham
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-needs_better_patch">
      <strong class="trac-field-needs_better_patch">Patch needs improvement</strong>
        set
    </li><li class="trac-field-summary">
      <strong class="trac-field-summary">Summary</strong>
        changed from <em>Remedy assertNumQueries dependence on some caches state</em> to <em>Allow assertNumQueries to clear caches before it runs</em>
    </li><li class="trac-field-stage">
      <strong class="trac-field-stage">Triage Stage</strong>
        changed from <em>Unreviewed</em> to <em>Accepted</em>
    </li><li class="trac-field-type">
      <strong class="trac-field-type">Type</strong>
        changed from <em>Bug</em> to <em>New feature</em>
    </li>
  </ul>
    <div class="comment searchable">
      <p>
The idea seems good, but rather than hard-coding a list of functions in <tt>clear_query_caches()</tt> I think it would be better to have some way to register a function to be included in that list. That way third-party code that uses caching can also take advantage of the functionality.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3-1415148509698362">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:3" class="cnum">
    <a href="#comment:3">comment:3</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-11-04T18%3A48%3A29-06%3A00&amp;precision=second" title="See timeline at 11/04/14 18:48:29">17 months ago</a> by wrwrwr
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-needs_better_patch">
      <strong class="trac-field-needs_better_patch">Patch needs improvement</strong>
        unset
    </li>
  </ul>
    <div class="comment searchable">
      <p>
A somewhat <a class="ext-link" href="https://github.com/wrwrwr/django/compare/ticket_23746?expand=1"><span class="icon">​</span>different solution</a>, with the same effect:<br />
</p>
<ul><li>added a new <tt>pre_capture_queries</tt> signal sent when entering the <tt>CaptureQueriesContext</tt> (also for the base manager not only <tt>assertNumQueries</tt>);
</li><li>dropped the <tt>clear_caches</tt> toggle as in the new context it seemed too general (which caches?); if you really want to miss some queries, selectively disconnecting their respective receivers is a less convenient, but more fine-grained option.
</li></ul><p>
There are some other possibilities to consider: -- a more general non-testing-only <tt>clear_caches</tt> signal, -- some <tt>register</tt> function on the test runner, or just bringing back the toggle for convenience.<br />
</p>

    </div>
  <div class="trac-lastedit ">
    Last edited <a class="timeline" href="/timeline?from=2014-11-04T18%3A50%3A16-06%3A00&amp;precision=second" title="See timeline at 11/04/14 18:50:16">17 months ago</a>
        by wrwrwr
      (<a href="/ticket/23746?cversion=0&amp;cnum_hist=3#comment:3">previous</a>)
      (<a href="/ticket/23746?action=comment-diff&amp;cnum=3&amp;version=1">diff</a>)
  </div>

              </div>
              <div class="change" id="trac-change-4-1416862606878898">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:4" class="cnum">
    <a href="#comment:4">comment:4</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-11-24T14%3A56%3A46-06%3A00&amp;precision=second" title="See timeline at 11/24/14 14:56:46">16 months ago</a> by wrwrwr
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Just one more note on this one, recently I've came across <a class="assigned ticket" href="/ticket/11505" title="New feature: Django's TestCase should reset the cache (assigned)">#11505</a> (there are also some discussions on the subject: <a class="ext-link" href="https://groups.google.com/forum/#!topic/django-users/OOGO-3MIO_c"><span class="icon">​</span>7/09</a>, <a class="ext-link" href="https://groups.google.com/forum/#!topic/django-developers/zlaPsP13dUY/discussion"><span class="icon">​</span>7/11</a>, <a class="ext-link" href="https://groups.google.com/forum/#!msg/django-developers/Ex7X2oFAHoc/TTma3dJU1ccJ"><span class="icon">​</span>10/11</a>). This ticket could be replaced by generalizing the cache clearing / restoring to include site / content type caches and possibly some of the lru_caches.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5-1417111873162856">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:5" class="cnum">
    <a href="#comment:5">comment:5</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2014-11-27T12%3A11%3A13-06%3A00&amp;precision=second" title="See timeline at 11/27/14 12:11:13">16 months ago</a> by Tim Graham &lt;timograham@…&gt;
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
In <a class="changeset" href="/changeset/7cd3f1c29595d1da7f37d29e7c3bc6a7a314cd1d" title="Fixed cache state dependence for assertNumQueries in ...">7cd3f1c29595d1da7f37d29e7c3bc6a7a314cd1d</a>:<br />
</p>
<div class="message"><p>
Fixed cache state dependence for assertNumQueries in test_group_permission_performance.<br />
</p>
<p>
Refs <a class="closed ticket" href="/ticket/20432" title="Bug: GroupAdminTest.test_group_permission_performance fail on full test ... (closed: fixed)">#20432</a> and <a class="new ticket" href="/ticket/23746" title="New feature: Allow assertNumQueries to clear caches before it runs (new)">#23746</a>.<br />
</p>
</div>
    </div>

              </div>
              <div class="change" id="trac-change-6-1426258944050227">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:6" class="cnum">
    <a href="#comment:6">comment:6</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-03-13T10%3A02%3A24-05%3A00&amp;precision=second" title="See timeline at 03/13/15 10:02:24">12 months ago</a> by timgraham
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I think it would be interesting to see a benchmark of adding a similar signal in <tt>SimpleTestCase._pre_setup()</tt> to clear the sites and contenttypes caches before each test. How much would that increase the runtime of the test suite? If we went with that approach, we probably wouldn't need the <tt>pre_capture_queries</tt> signal.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7-1426263522326799">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:7" class="cnum">
    <a href="#comment:7">comment:7</a>
  </span>
    </span>
        Changed <a class="timeline" href="/timeline?from=2015-03-13T11%3A18%3A42-05%3A00&amp;precision=second" title="See timeline at 03/13/15 11:18:42">12 months ago</a> by timgraham
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-cc">
      <strong class="trac-field-cc">Cc</strong>
        <em>timgraham</em> added
    </li><li class="trac-field-needs_better_patch">
      <strong class="trac-field-needs_better_patch">Patch needs improvement</strong>
        set
    </li>
  </ul>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/23746?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/23746?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/23746?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
          <a href="#top" class="backtotop"><i class="icon icon-chevron-up"></i> Back to Top</a>
        </div>
      </div>
    <div role="contentinfo">
      <div class="subfooter">
        <div class="container">
          <h1 class="visuallyhidden">Django Links</h1>
          <div class="col learn">
            <h2>Learn More</h2>
            <ul>
              <li><a href="https://www.djangoproject.com/overview/">About Django</a></li>
              <li><a href="https://www.djangoproject.com/start/">Getting Started with Django</a></li>
              <li><a href="https://www.djangoproject.com/foundation/">Django Software Foundation</a></li>
              <li><a href="https://www.djangoproject.com/conduct/">Code of Conduct</a></li>
            </ul>
          </div>
          <div class="col involved">
            <h2>Get Involved</h2>
            <ul>
              <li><a href="https://www.djangoproject.com/community/">Join a Group</a></li>
              <li><a href="https://docs.djangoproject.com/en/dev/internals/contributing/">Contribute to Django</a></li>
              <li><a href="https://docs.djangoproject.com/en/dev/internals/contributing/bugs-and-features/#reporting-security-issues">Submit a Bug</a></li>
              <li><a href="https://docs.djangoproject.com/en/dev/internals/security/">Report a Security Issue</a></li>
            </ul>
          </div>
          <div class="col follow">
            <h2>Follow Us</h2>
            <ul>
              <li><a href="http://github.com/django">GitHub</a></li>
              <li><a href="https://twitter.com/djangoproject">Twitter</a></li>
              <li><a href="https://www.djangoproject.com/rss/weblog/">News RSS</a></li>
              <li><a href="https://groups.google.com/forum/#!forum/django-users">Django Users Mailing List</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer">
        <div class="container">
          <div class="footer-logo">
            <a class="logo" href="https://djangoproject.com/">Django</a>
          </div>
          <ul class="thanks">
            <li><span>Hosting by</span> <a class="rackspace" href="http://rackspace.com">Rackspace</a></li>
            <li class="design"><span>Design by</span> <a class="threespot" href="http://www.threespot.com">Threespot</a> <span class="ampersand">&amp;</span> <a class="andrevv" href="http://andrevv.com/"></a></li>
          </ul>
          <p class="copyright">© 2005-2016
              <a href="https://djangoproject.com/foundation/"> Django Software
              Foundation</a> unless otherwise noted. Django is a
              <a href="https://djangoproject.com/trademarks/">registered
              trademark</a> of the Django Software Foundation.
          </p>
        </div>
      </div>
    </div>
  <script data-main="/chrome/site/js/main.js" src="/chrome/site/js/lib/require.js"></script>
  </body>
</html>